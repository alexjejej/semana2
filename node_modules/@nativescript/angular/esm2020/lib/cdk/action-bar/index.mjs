import { Directive, Component, ElementRef, Optional } from '@angular/core';
import { ActionBar, ActionItem, NavigationButton, Page } from '@nativescript/core';
import { isBlank } from '../../utils/lang-facade';
import { isInvisibleNode, isView } from '../../views/utils';
import { registerElement } from '../../element-registry';
import * as i0 from "@angular/core";
import * as i1 from "@nativescript/core";
export function isActionItem(view) {
    return view instanceof ActionItem;
}
export function isNavigationButton(view) {
    return view instanceof NavigationButton;
}
export const actionBarMeta = {
    skipAddToDom: true,
    insertChild: (parent, child, next) => {
        if (isInvisibleNode(child)) {
            return;
        }
        else if (isNavigationButton(child)) {
            parent.navigationButton = child;
            child.parentNode = parent;
        }
        else if (isActionItem(child)) {
            addActionItem(parent, child, next);
            child.parentNode = parent;
        }
        else if (isView(child)) {
            parent.titleView = child;
        }
    },
    removeChild: (parent, child) => {
        if (isInvisibleNode(child)) {
            return;
        }
        else if (isNavigationButton(child)) {
            if (parent.navigationButton === child) {
                parent.navigationButton = null;
            }
            child.parentNode = null;
        }
        else if (isActionItem(child)) {
            parent.actionItems.removeItem(child);
            child.parentNode = null;
        }
        else if (isView(child) && parent.titleView && parent.titleView === child) {
            parent.titleView = null;
        }
    },
};
registerElement('ActionBar', () => ActionBar, actionBarMeta);
registerElement('ActionItem', () => ActionItem);
registerElement('NavigationButton', () => NavigationButton);
const addActionItem = (bar, item, next) => {
    if (next) {
        insertActionItemBefore(bar, item, next);
    }
    else {
        appendActionItem(bar, item);
    }
};
const insertActionItemBefore = (bar, item, next) => {
    const actionItems = bar.actionItems;
    const actionItemsCollection = actionItems.getItems();
    const indexToInsert = actionItemsCollection.indexOf(next);
    actionItemsCollection.splice(indexToInsert, 0, item);
    actionItems.setItems(actionItemsCollection);
};
const appendActionItem = (bar, item) => {
    bar.actionItems.addItem(item);
};
export class ActionBarComponent {
    constructor(element, page) {
        this.element = element;
        this.page = page;
        if (!this.page) {
            throw new Error('No Page found in ActionBarComponent.\n' + 'Only a Page can contain an ActionBar, so please ensure ActionBar is only used inside a Component that is routed via page-router-outlet or is contained in a Page.\n' + 'Example for root action bars in AppComponent: <Frame><Page><ActionBar>....</ActionBar></Page></Frame>');
        }
        if (isBlank(this.page.actionBarHidden)) {
            this.page.actionBarHidden = false;
        }
        this.page.actionBar = this.element.nativeElement;
        this.page.actionBar.update();
    }
}
ActionBarComponent.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: ActionBarComponent, deps: [{ token: i0.ElementRef }, { token: i1.Page, optional: true }], target: i0.ɵɵFactoryTarget.Component });
ActionBarComponent.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: ActionBarComponent, selector: "ActionBar", ngImport: i0, template: '<ng-content></ng-content>', isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: ActionBarComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'ActionBar',
                    template: '<ng-content></ng-content>',
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: i1.Page, decorators: [{
                    type: Optional
                }] }]; } });
export class ActionBarScope {
    // tslint:disable-line:component-class-suffix
    constructor(page) {
        this.page = page;
        if (!this.page) {
            throw new Error('Inside ActionBarExtension but no ActionBar found to extend.');
        }
    }
    onNavButtonInit(navBtn) {
        this.page.actionBar.navigationButton = navBtn.element.nativeElement;
    }
    onNavButtonDestroy(navBtn) {
        const nav = navBtn.element.nativeElement;
        if (nav && this.page.actionBar.navigationButton === nav) {
            this.page.actionBar.navigationButton = null;
        }
    }
    onActionInit(item) {
        this.page.actionBar.actionItems.addItem(item.element.nativeElement);
    }
    onActionDestroy(item) {
        if (item.element.nativeElement.actionBar) {
            this.page.actionBar.actionItems.removeItem(item.element.nativeElement);
        }
    }
}
ActionBarScope.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: ActionBarScope, deps: [{ token: i1.Page, optional: true }], target: i0.ɵɵFactoryTarget.Component });
ActionBarScope.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "12.0.0", version: "13.1.1", type: ActionBarScope, selector: "ActionBarExtension", ngImport: i0, template: '', isInline: true });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: ActionBarScope, decorators: [{
            type: Component,
            args: [{
                    selector: 'ActionBarExtension',
                    template: '',
                }]
        }], ctorParameters: function () { return [{ type: i1.Page, decorators: [{
                    type: Optional
                }] }]; } });
export class ActionItemDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onActionInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onActionDestroy(this);
        }
    }
}
ActionItemDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: ActionItemDirective, deps: [{ token: i0.ElementRef }, { token: ActionBarScope, optional: true }], target: i0.ɵɵFactoryTarget.Directive });
ActionItemDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.1", type: ActionItemDirective, selector: "ActionItem", ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: ActionItemDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'ActionItem', // tslint:disable-line:directive-selector
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: ActionBarScope, decorators: [{
                    type: Optional
                }] }]; } });
export class NavigationButtonDirective {
    constructor(element, ownerScope) {
        this.element = element;
        this.ownerScope = ownerScope;
        if (this.ownerScope) {
            this.ownerScope.onNavButtonInit(this);
        }
    }
    ngOnDestroy() {
        if (this.ownerScope) {
            this.ownerScope.onNavButtonDestroy(this);
        }
    }
}
NavigationButtonDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NavigationButtonDirective, deps: [{ token: i0.ElementRef }, { token: ActionBarScope, optional: true }], target: i0.ɵɵFactoryTarget.Directive });
NavigationButtonDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "12.0.0", version: "13.1.1", type: NavigationButtonDirective, selector: "NavigationButton", ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "13.1.1", ngImport: i0, type: NavigationButtonDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: 'NavigationButton', // tslint:disable-line:directive-selector
                }]
        }], ctorParameters: function () { return [{ type: i0.ElementRef }, { type: ActionBarScope, decorators: [{
                    type: Optional
                }] }]; } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaW5kZXguanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9wYWNrYWdlcy9hbmd1bGFyL3NyYy9saWIvY2RrL2FjdGlvbi1iYXIvaW5kZXgudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsVUFBVSxFQUFFLFFBQVEsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUN0RixPQUFPLEVBQUUsU0FBUyxFQUFFLFVBQVUsRUFBZSxnQkFBZ0IsRUFBRSxJQUFJLEVBQUUsTUFBTSxvQkFBb0IsQ0FBQztBQUVoRyxPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0seUJBQXlCLENBQUM7QUFFbEQsT0FBTyxFQUFFLGVBQWUsRUFBRSxNQUFNLEVBQUUsTUFBTSxtQkFBbUIsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZUFBZSxFQUFFLE1BQU0sd0JBQXdCLENBQUM7OztBQUV6RCxNQUFNLFVBQVUsWUFBWSxDQUFDLElBQVM7SUFDcEMsT0FBTyxJQUFJLFlBQVksVUFBVSxDQUFDO0FBQ3BDLENBQUM7QUFFRCxNQUFNLFVBQVUsa0JBQWtCLENBQUMsSUFBUztJQUMxQyxPQUFPLElBQUksWUFBWSxnQkFBZ0IsQ0FBQztBQUMxQyxDQUFDO0FBSUQsTUFBTSxDQUFDLE1BQU0sYUFBYSxHQUFrQjtJQUMxQyxZQUFZLEVBQUUsSUFBSTtJQUNsQixXQUFXLEVBQUUsQ0FBQyxNQUFtQixFQUFFLEtBQWEsRUFBRSxJQUFTLEVBQUUsRUFBRTtRQUM3RCxJQUFJLGVBQWUsQ0FBQyxLQUFLLENBQUMsRUFBRTtZQUMxQixPQUFPO1NBQ1I7YUFBTSxJQUFJLGtCQUFrQixDQUFDLEtBQUssQ0FBQyxFQUFFO1lBQ3BDLE1BQU0sQ0FBQyxnQkFBZ0IsR0FBRyxLQUFLLENBQUM7WUFDaEMsS0FBSyxDQUFDLFVBQVUsR0FBRyxNQUFNLENBQUM7U0FDM0I7YUFBTSxJQUFJLFlBQVksQ0FBQyxLQUFLLENBQUMsRUFB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TyxHQUFQLE9BQU8sQ0FBWTtRQUFzQixlQUFVLEdBQVYsVUFBVSxDQUFnQjtRQUNwRixJQUFJLElBQUksQ0FBQyxVQUFVLEVBQUU7WUFDbkIsSUFBSSxDQUFDLFVBQVUsQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLENBQUM7U0FDdkM7SUFDSCxDQUFDO0lBRUQsV0FBVztRQUNULElBQUksSUFBSSxDQUFDLFVBQVUsRUFBRTtZQUNuQixJQUFJLENBQUMsVUFBVSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxDQUFDO1NBQzFDO0lBQ0gsQ0FBQzs7c0hBWFUseUJBQXlCLDRDQUNvQyxjQUFjOzBHQUQzRSx5QkFBeUI7MkZBQXpCLHlCQUF5QjtrQkFIckMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsa0JBQWtCLEVBQUUseUNBQXlDO2lCQUN4RTttRkFFeUUsY0FBYzswQkFBN0MsUUFBUSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IERpcmVjdGl2ZSwgQ29tcG9uZW50LCBFbGVtZW50UmVmLCBPcHRpb25hbCwgT25EZXN0cm95IH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBBY3Rpb25CYXIsIEFjdGlvbkl0ZW0sIEFjdGlvbkl0ZW1zLCBOYXZpZ2F0aW9uQnV0dG9uLCBQYWdlIH0gZnJvbSAnQG5hdGl2ZXNjcmlwdC9jb3JlJztcblxuaW1wb3J0IHsgaXNCbGFuayB9IGZyb20gJy4uLy4uL3V0aWxzL2xhbmctZmFjYWRlJztcbmltcG9ydCB7IE5nVmlldywgVmlld0NsYXNzTWV0YSwgVmlld0V4dGVuc2lvbnMgfSBmcm9tICcuLi8uLi92aWV3cy92aWV3LXR5cGVzJztcbmltcG9ydCB7IGlzSW52aXNpYmxlTm9kZSwgaXNWaWV3IH0gZnJvbSAnLi4vLi4vdmlld3MvdXRpbHMnO1xuaW1wb3J0IHsgcmVnaXN0ZXJFbGVtZW50IH0gZnJvbSAnLi4vLi4vZWxlbWVudC1yZWdpc3RyeSc7XG5cbmV4cG9ydCBmdW5jdGlvbiBpc0FjdGlvbkl0ZW0odmlldzogYW55KTogdmlldyBpcyBBY3Rpb25JdGVtIHtcbiAgcmV0dXJuIHZpZXcgaW5zdGFuY2VvZiBBY3Rpb25JdGVtO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gaXNOYXZpZ2F0aW9uQnV0dG9uKHZpZXc6IGFueSk6IHZpZXcgaXMgTmF2aWdhdGlvbkJ1dHRvbiB7XG4gIHJldHVybiB2aWV3IGluc3RhbmNlb2YgTmF2aWdhdGlvbkJ1dHRvbjtcbn1cblxudHlwZSBOZ0FjdGlvbkJhciA9IEFjdGlvbkJhciAmIFZpZXdFeHRlbnNpb25zO1xuXG5leHBvcnQgY29uc3QgYWN0aW9uQmFyTWV0YTogVmlld0NsYXNzTWV0YSA9IHtcbiAgc2tpcEFkZFRvRG9tOiB0cnVlLFxuICBpbnNlcnRDaGlsZDogKHBhcmVudDogTmdBY3Rpb25CYXIsIGNoaWxkOiBOZ1ZpZXcsIG5leHQ6IGFueSkgPT4ge1xuICAgIGlmIChpc0ludmlzaWJsZU5vZGUoY2hpbGQpKSB7XG4gICAgICByZXR1cm47XG4gICAgfSBlbHNlIGlmIChpc05hdmlnYXRpb25CdXR0b24oY2hpbGQpKSB7XG4gICAgICBwYXJlbnQubmF2aWdhdGlvbkJ1dHRvbiA9IGNoaWxkO1xuICAgICAgY2hpbGQucGFyZW50Tm9kZSA9IHBhcmVudDtcbiAgICB9IGVsc2UgaWYgKGlzQWN0aW9uSXRlbShjaGlsZCkpIHtcbiAgICAgIGFkZEFjdGlvbkl0ZW0ocGFyZW50LCBjaGlsZCwgbmV4dCk7XG4gICAgICBjaGlsZC5wYXJlbnROb2RlID0gcGFyZW50O1xuICAgIH0gZWxzZSBpZiAoaXNWaWV3KGNoaWxkKSkge1xuICAgICAgcGFyZW50LnRpdGxlVmlldyA9IGNoaWxkO1xuICAgIH1cbiAgfSxcbiAgcmVtb3ZlQ2hpbGQ6IChwYXJlbnQ6IE5nQWN0aW9uQmFyLCBjaGlsZDogTmdWaWV3KSA9PiB7XG4gICAgaWYgKGlzSW52aXNpYmxlTm9kZShjaGlsZCkpIHtcbiAgICAgIHJldHVybjtcbiAgICB9IGVsc2UgaWYgKGlzTmF2aWdhdGlvbkJ1dHRvbihjaGlsZCkpIHtcbiAgICAgIGlmIChwYXJlbnQubmF2aWdhdGlvbkJ1dHRvbiA9PT0gY2hpbGQpIHtcbiAgICAgICAgcGFyZW50Lm5hdmlnYXRpb25CdXR0b24gPSBudWxsO1xuICAgICAgfVxuXG4gICAgICBjaGlsZC5wYXJlbnROb2RlID0gbnVsbDtcbiAgICB9IGVsc2UgaWYgKGlzQWN0aW9uSXRlbShjaGlsZCkpIHtcbiAgICAgIHBhcmVudC5hY3Rpb25JdGVtcy5yZW1vdmVJdGVtKGNoaWxkKTtcbiAgICAgIGNoaWxkLnBhcmVudE5vZGUgPSBudWxsO1xuICAgIH0gZWxzZSBpZiAoaXNWaWV3KGNoaWxkKSAmJiBwYXJlbnQudGl0bGVWaWV3ICYmIHBhcmVudC50aXRsZVZpZXcgPT09IGNoaWxkKSB7XG4gICAgICBwYXJlbnQudGl0bGVWaWV3ID0gbnVsbDtcbiAgICB9XG4gIH0sXG59O1xuXG5yZWdpc3RlckVsZW1lbnQoJ0FjdGlvbkJhcicsICgpID0+IEFjdGlvbkJhciwgYWN0aW9uQmFyTWV0YSk7XG5yZWdpc3RlckVsZW1lbnQoJ0FjdGlvbkl0ZW0nLCAoKSA9PiA8YW55PkFjdGlvbkl0ZW0pO1xucmVnaXN0ZXJFbGVtZW50KCdOYXZpZ2F0aW9uQnV0dG9uJywgKCkgPT4gPGFueT5OYXZpZ2F0aW9uQnV0dG9uKTtcblxuY29uc3QgYWRkQWN0aW9uSXRlbSA9IChiYXI6IE5nQWN0aW9uQmFyLCBpdGVtOiBBY3Rpb25JdGVtLCBuZXh0OiBBY3Rpb25JdGVtKSA9PiB7XG4gIGlmIChuZXh0KSB7XG4gICAgaW5zZXJ0QWN0aW9uSXRlbUJlZm9yZShiYXIsIGl0ZW0sIG5leHQpO1xuICB9IGVsc2Uge1xuICAgIGFwcGVuZEFjdGlvbkl0ZW0oYmFyLCBpdGVtKTtcbiAgfVxufTtcblxuY29uc3QgaW5zZXJ0QWN0aW9uSXRlbUJlZm9yZSA9IChiYXI6IE5nQWN0aW9uQmFyLCBpdGVtOiBBY3Rpb25JdGVtLCBuZXh0OiBBY3Rpb25JdGVtKSA9PiB7XG4gIGNvbnN0IGFjdGlvbkl0ZW1zOiBBY3Rpb25JdGVtcyA9IGJhci5hY3Rpb25JdGVtcztcbiAgY29uc3QgYWN0aW9uSXRlbXNDb2xsZWN0aW9uOiBBY3Rpb25JdGVtW10gPSBhY3Rpb25JdGVtcy5nZXRJdGVtcygpO1xuXG4gIGNvbnN0IGluZGV4VG9JbnNlcnQgPSBhY3Rpb25JdGVtc0NvbGxlY3Rpb24uaW5kZXhPZihuZXh0KTtcbiAgYWN0aW9uSXRlbXNDb2xsZWN0aW9uLnNwbGljZShpbmRleFRvSW5zZXJ0LCAwLCBpdGVtKTtcblxuICAoPGFueT5hY3Rpb25JdGVtcykuc2V0SXRlbXMoYWN0aW9uSXRlbXNDb2xsZWN0aW9uKTtcbn07XG5cbmNvbnN0IGFwcGVuZEFjdGlvbkl0ZW0gPSAoYmFyOiBOZ0FjdGlvbkJhciwgaXRlbTogQWN0aW9uSXRlbSkgPT4ge1xuICBiYXIuYWN0aW9uSXRlbXMuYWRkSXRlbShpdGVtKTtcbn07XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0FjdGlvbkJhcicsXG4gIHRlbXBsYXRlOiAnPG5nLWNvbnRlbnQ+PC9uZy1jb250ZW50PicsXG59KVxuZXhwb3J0IGNsYXNzIEFjdGlvbkJhckNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHB1YmxpYyBlbGVtZW50OiBFbGVtZW50UmVmLCBAT3B0aW9uYWwoKSBwcml2YXRlIHBhZ2U6IFBhZ2UpIHtcbiAgICBpZiAoIXRoaXMucGFnZSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdObyBQYWdlIGZvdW5kIGluIEFjdGlvbkJhckNvbXBvbmVudC5cXG4nICsgJ09ubHkgYSBQYWdlIGNhbiBjb250YWluIGFuIEFjdGlvbkJhciwgc28gcGxlYXNlIGVuc3VyZSBBY3Rpb25CYXIgaXMgb25seSB1c2VkIGluc2lkZSBhIENvbXBvbmVudCB0aGF0IGlzIHJvdXRlZCB2aWEgcGFnZS1yb3V0ZXItb3V0bGV0IG9yIGlzIGNvbnRhaW5lZCBpbiBhIFBhZ2UuXFxuJyArICdFeGFtcGxlIGZvciByb290IGFjdGlvbiBiYXJzIGluIEFwcENvbXBvbmVudDogPEZyYW1lPjxQYWdlPjxBY3Rpb25CYXI+Li4uLjwvQWN0aW9uQmFyPjwvUGFnZT48L0ZyYW1lPicpO1xuICAgIH1cblxuICAgIGlmIChpc0JsYW5rKHRoaXMucGFnZS5hY3Rpb25CYXJIaWRkZW4pKSB7XG4gICAgICB0aGlzLnBhZ2UuYWN0aW9uQmFySGlkZGVuID0gZmFsc2U7XG4gICAgfVxuICAgIHRoaXMucGFnZS5hY3Rpb25CYXIgPSB0aGlzLmVsZW1lbnQubmF0aXZlRWxlbWVudDtcbiAgICB0aGlzLnBhZ2UuYWN0aW9uQmFyLnVwZGF0ZSgpO1xuICB9XG59XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ0FjdGlvbkJhckV4dGVuc2lvbicsXG4gIHRlbXBsYXRlOiAnJyxcbn0pXG5leHBvcnQgY2xhc3MgQWN0aW9uQmFyU2NvcGUge1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1saW5lOmNvbXBvbmVudC1jbGFzcy1zdWZmaXhcbiAgY29uc3RydWN0b3IoQE9wdGlvbmFsKCkgcHJpdmF0ZSBwYWdlOiBQYWdlKSB7XG4gICAgaWYgKCF0aGlzLnBhZ2UpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignSW5zaWRlIEFjdGlvbkJhckV4dGVuc2lvbiBidXQgbm8gQWN0aW9uQmFyIGZvdW5kIHRvIGV4dGVuZC4nKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25OYXZCdXR0b25Jbml0KG5hdkJ0bjogTmF2aWdhdGlvbkJ1dHRvbkRpcmVjdGl2ZSkge1xuICAgIHRoaXMucGFnZS5hY3Rpb25CYXIubmF2aWdhdGlvbkJ1dHRvbiA9IG5hdkJ0bi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gIH1cblxuICBwdWJsaWMgb25OYXZCdXR0b25EZXN0cm95KG5hdkJ0bjogTmF2aWdhdGlvbkJ1dHRvbkRpcmVjdGl2ZSkge1xuICAgIGNvbnN0IG5hdiA9IDxOYXZpZ2F0aW9uQnV0dG9uPm5hdkJ0bi5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQ7XG4gICAgaWYgKG5hdiAmJiB0aGlzLnBhZ2UuYWN0aW9uQmFyLm5hdmlnYXRpb25CdXR0b24gPT09IG5hdikge1xuICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhci5uYXZpZ2F0aW9uQnV0dG9uID0gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgb25BY3Rpb25Jbml0KGl0ZW06IEFjdGlvbkl0ZW1EaXJlY3RpdmUpIHtcbiAgICB0aGlzLnBhZ2UuYWN0aW9uQmFyLmFjdGlvbkl0ZW1zLmFkZEl0ZW0oaXRlbS5lbGVtZW50Lm5hdGl2ZUVsZW1lbnQpO1xuICB9XG5cbiAgcHVibGljIG9uQWN0aW9uRGVzdHJveShpdGVtOiBBY3Rpb25JdGVtRGlyZWN0aXZlKSB7XG4gICAgaWYgKGl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50LmFjdGlvbkJhcikge1xuICAgICAgdGhpcy5wYWdlLmFjdGlvbkJhci5hY3Rpb25JdGVtcy5yZW1vdmVJdGVtKGl0ZW0uZWxlbWVudC5uYXRpdmVFbGVtZW50KTtcbiAgICB9XG4gIH1cbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnQWN0aW9uSXRlbScsIC8vIHRzbGludDpkaXNhYmxlLWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXG59KVxuZXhwb3J0IGNsYXNzIEFjdGlvbkl0ZW1EaXJlY3RpdmUgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgZWxlbWVudDogRWxlbWVudFJlZiwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBvd25lclNjb3BlOiBBY3Rpb25CYXJTY29wZSkge1xuICAgIGlmICh0aGlzLm93bmVyU2NvcGUpIHtcbiAgICAgIHRoaXMub3duZXJTY29wZS5vbkFjdGlvbkluaXQodGhpcyk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMub3duZXJTY29wZSkge1xuICAgICAgdGhpcy5vd25lclNjb3BlLm9uQWN0aW9uRGVzdHJveSh0aGlzKTtcbiAgICB9XG4gIH1cbn1cblxuQERpcmVjdGl2ZSh7XG4gIHNlbGVjdG9yOiAnTmF2aWdhdGlvbkJ1dHRvbicsIC8vIHRzbGludDpkaXNhYmxlLWxpbmU6ZGlyZWN0aXZlLXNlbGVjdG9yXG59KVxuZXhwb3J0IGNsYXNzIE5hdmlnYXRpb25CdXR0b25EaXJlY3RpdmUgaW1wbGVtZW50cyBPbkRlc3Ryb3kge1xuICBjb25zdHJ1Y3RvcihwdWJsaWMgZWxlbWVudDogRWxlbWVudFJlZiwgQE9wdGlvbmFsKCkgcHJpdmF0ZSBvd25lclNjb3BlOiBBY3Rpb25CYXJTY29wZSkge1xuICAgIGlmICh0aGlzLm93bmVyU2NvcGUpIHtcbiAgICAgIHRoaXMub3duZXJTY29wZS5vbk5hdkJ1dHRvbkluaXQodGhpcyk7XG4gICAgfVxuICB9XG5cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgaWYgKHRoaXMub3duZXJTY29wZSkge1xuICAgICAgdGhpcy5vd25lclNjb3BlLm9uTmF2QnV0dG9uRGVzdHJveSh0aGlzKTtcbiAgICB9XG4gIH1cbn1cbiJdfQ==